#!/usr/bin/env python3
import requests
import re
from zipfile import ZipFile
import json


filename = 'nvdcve-1.0-2019.json'


def download_cve_zip_file():
    url = "https://static.nvd.nist.gov/feeds/json/cve/1.0/" + filename + '.zip'
    req = requests.get(url)
    file = open(filename + '.zip', 'wb')
    for chunk in req.iter_content(100000):
        file.write(chunk)
    file.close()


def extract_cve_zip_file(filename):
    with ZipFile(filename + '.zip', 'r') as zipObj:
        zipObj.extractall()


def check_keyword_in_cve_file(keyword):
    with open(filename) as f:
        datafile = f.readlines()
        keyword_result_list = []
    for line in datafile:
        if keyword in line:
            keyword_result_list.append(line)
            with open(keyword + '_list.json', mode='w') as f:
                f.write(json.dumps(keyword_result_list, indent=2))
    return keyword_result_list  # Because you finished the search without finding



def main():
    download_cve_zip_file()
    extract_cve_zip_file(filename)
    check_keyword_in_cve_file('kubernetes')


if __name__ == "__main__":
    main()

